<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.asoview.weather.core.datasource.weatherdate.WeatherDateMapper">

    <resultMap id="weatherDateSummary" type="com.asoview.weather.core.model.weatherdate.WeatherDateSummary">
        <result property="cityId" column="id"/>
        <result property="cityName" column="city_name"/>
        <result property="weatherDate" column="weather_day"/>
        <result property="weatherDateId" column="weather_day_id"/>
    </resultMap>

    <select id="getAll" resultMap="weatherDateSummary">
        SELECT
        cities.id,
        cities.city_name,
        DATE_FORMAT(weather_day.weather_date, '%Y/%c/%e') weather_day,
        weather_day.id weather_day_id
        FROM
        weather.cities cities
        INNER JOIN
        weather.weather_day ON weather.cities.id = weather.weather_day.city_id
        GROUP BY
        cities.id, cities.city_name, weather_day, weather_day_id
        ORDER By
        weather_day DESC

    </select>

    <delete id="remove">
        DELETE FROM weather.weather_day WHERE id = #{weatherDateId}
    </delete>

    <delete id="removeByCurrentDate">
        DELETE
        FROM
        weather.weather_day
        WHERE
        DATE_FORMAT(weather_date, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND
        city_id = #{cityId}
    </delete>

</mapper>